<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <script src="https://www.gstatic.com/firebasejs/3.6.1/firebase.js"></script>
    <script src="main.js"></script>
    <script src="appfb.js"></script>
</head>
<body>
<script>
    var app = Elm.Main.fullscreen();

    app.ports.addMemberPort.subscribe(function (member) {
        addMember(member).then(function (response) {
            console.log('member added', response)
//            app.ports.customerSaved.send(response.key);
        }, function (err) {
            console.log("error:", err);
        });
    });

    app.ports.updateMemberPort.subscribe(function (member) {
        console.log(member);
        updateMember(member).then(function (response) {
            console.log('member updated', response)
//            app.ports.customerSaved.send(response.key);
        }, function (err) {
            console.log("error:", err);
        });
    });

    app.ports.addLineItemPort.subscribe(function (lineItem) {
      addLineItem(lineItem).then(function (response) {
        console.log('lineItem added', response)
//            app.ports.customerSaved.send(response.key);
      }, function (err) {
        console.log("error:", err);
      });
    });


    var memberListener = memberListener();
    memberListener.on("child_added", function (data) {
        var member = Object.assign({}, data.val(), { id: data.key });
        app.ports.memberAdded.send(member);
    });
    memberListener.on("child_changed", function (data) {
        var member = Object.assign({}, data.val(), { id: data.key });
        app.ports.memberUpdated.send(member);
    });

    var lineItemlistener = lineItemlistener();
    lineItemlistener.on("child_added", function (data) {
        var lineItem = Object.assign({}, data.val(), { id: data.key });
        app.ports.lineItemAdded.send(lineItem);
    });
    lineItemlistener.on("child_changed", function (data) {
        var member = Object.assign({}, data.val(), { id: data.key });
        app.ports.memberUpdated.send(member);
    });


</script>
</body>
</html>
